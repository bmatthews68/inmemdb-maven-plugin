<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 19 May 2014 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>In-Memory Database Maven Plugin - Integration testing web applications with Jetty and Selenium</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
      <meta name="author" content="Brian Matthews" />
    <meta name="Date-Creation-yyyymmdd" content="20121218" />
    <meta name="Date-Revision-yyyymmdd" content="20140519" />
    <meta http-equiv="Content-Language" content="en" />
        
          <!-- Google Analytics -->
    <script type="text/javascript">
    
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-5713196-8']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://inmemdb-maven-plugin.btmatthews.com" id="bannerLeft">
                In-Memory Database Maven Plugin
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 19 May 2014</span>
                  &nbsp;| <span id="projectVersion">Version: 1.4.3-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="http://maven.apache.org/" class="externalLink" title="Maven 3">Maven 3</a>
            |
                        <a href="http://hsqldb.org/" class="externalLink" title="HSQLDB">HSQLDB</a>
            |
                        <a href="http://www.h2database.com/" class="externalLink" title="H2">H2</a>
            |
                        <a href="http://db.apache.org/derby/" class="externalLink" title="Derby">Derby</a>
            |
                        <a href="http://www.dbunit.org/" class="externalLink" title="DBUnit">DBUnit</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="../plugin-info.html" title="Goals">Goals</a>
            </li>
                  <li class="none">
                          <a href="../usage.html" title="Usage">Usage</a>
            </li>
          </ul>
                       <h5>Examples</h5>
                  <ul>
                  <li class="none">
            <strong>Web application integration testing</strong>
          </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                      <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                                                                                                                               <a href="http://maven.apache.org/" title="Maven" class="poweredBy">
        <img class="poweredBy"  alt="Maven" src="http://maven.apache.org/images/logos/maven-feather.png"     />
      </a>
                       
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!-- Copyright 2011-2012 Brian Matthews --><!--  --><!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><div class="section">
<h2>Integration testing web applications with Jetty and Selenium<a name="Integration_testing_web_applications_with_Jetty_and_Selenium"></a></h2>
<p>The <b>In-Memory Database Maven Plugin</b> can be used to automate integration tests with having a dependency on an external database server.</p>
<div class="section">
<h3>pom.xml<a name="pom.xml"></a></h3>
<p>The POM here is from taken from the <a class="externalLink" href="https://github
  .com/bmatthews68/inmemdb-maven-plugin/tree/master/src/it/webapp">webapp</a> integration test for the <b>In-Memory Database Maven Plugin</b>.</p>
<div>
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;
             http://maven.apache.org/POM/4.0.0
             http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;webapp&lt;/groupId&gt;
    &lt;artifactId&gt;webapp&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.btmatthews.maven.plugins.inmemdb&lt;/groupId&gt;
                &lt;artifactId&gt;inmemdb-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.4.3-SNAPSHOT&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;monitorKey&gt;inmemdb&lt;/monitorKey&gt;
                    &lt;monitorPort&gt;11527&lt;/monitorPort&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;run&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;run&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                        &lt;configuration&gt;
                            &lt;daemon&gt;true&lt;/daemon&gt;
                            &lt;type&gt;derby&lt;/type&gt;
                            &lt;database&gt;test&lt;/database&gt;
                            &lt;username&gt;sa&lt;/username&gt;
                            &lt;password&gt;&lt;/password&gt;
                            &lt;sources&gt;
                                &lt;script&gt;
                                    &lt;sourceFile&gt;src/test/resources/create_database.sql&lt;/sourceFile&gt;
                                &lt;/script&gt;
                                &lt;dataSet&gt;
                                    &lt;sourceFile&gt;src/test/resources/users.dbunit.xml&lt;/sourceFile&gt;
                                &lt;/dataSet&gt;
                            &lt;/sources&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;</pre></div>
<p>The <b>In-Memory Database Maven Plugin</b> is configured here to launch an in-memory <a class="externalLink" href="http://db.apache.org/derby/">Apache Derby</a> database server as a daemon process during the <b>pre-integration-test</b> phase of the build life cycle. The database is initialised with a database schema and some seed data.</p>
<div>
<pre>                    &lt;execution&gt;
                        &lt;id&gt;stop&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;stop&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;phase&gt;post-integration-test&lt;/phase&gt;
                    &lt;/execution&gt;</pre></div>
<p>The <b>In-Memory Database Maven Plugin</b> is configured here to shutdown the in-memory <a class="externalLink" href="http://db.apache.org/derby/">Apache Derby</a> database server during the <b>post-integration-test</b> phase of the build life cycle.</p>
<div>
<pre>                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;
                &lt;artifactId&gt;jetty-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;8.1.8.v20121106&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;stopKey&gt;jetty&lt;/stopKey&gt;
                    &lt;stopPort&gt;19080&lt;/stopPort&gt;
                    &lt;daemon&gt;true&lt;/daemon&gt;
                    &lt;webApp&gt;
                        &lt;contextPath&gt;/&lt;/contextPath&gt;
                    &lt;/webApp&gt;
                    &lt;jettyXml&gt;src/test/jetty/jetty.xml&lt;/jettyXml&gt;
                    &lt;connectors&gt;
                        &lt;connector implementation=&quot;org.eclipse.jetty.server.nio.SelectChannelConnector&quot;&gt;
                            &lt;port&gt;9080&lt;/port&gt;
                            &lt;maxIdleTime&gt;60000&lt;/maxIdleTime&gt;
                        &lt;/connector&gt;
                    &lt;/connectors&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;start-jetty&lt;/id&gt;
                        &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;run&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;</pre></div>
<p>The <a class="externalLink" href="http://wiki.eclipse.org/Jetty/Feature/Jetty_Maven_Plugin">Jetty Maven Plugin</a> is configured here to launch the <a class="externalLink" href="http://wiki.eclipse.org/Jetty/">Jetty</a> servlet container as a daemon process during the <b>pre-integration-test</b> phase of the build life cycle.</p>
<div>
<pre>                    &lt;execution&gt;
                        &lt;id&gt;stop-jetty&lt;/id&gt;
                        &lt;phase&gt;post-integration-test&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;stop&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;</pre></div>
<p>The <a class="externalLink" href="http://wiki.eclipse.org/Jetty/Feature/Jetty_Maven_Plugin">Jetty Maven Plugin</a> is configured here to shutdown the <a class="externalLink" href="http://wiki.eclipse.org/Jetty/">Jetty</a> servlet container during the <b>post-integration-test</b> phase of the build life cycle.</p>
<div>
<pre>                &lt;/executions&gt;
                &lt;dependencies&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.apache.derby&lt;/groupId&gt;
                        &lt;artifactId&gt;derbyclient&lt;/artifactId&gt;
                        &lt;version&gt;10.9.1.0&lt;/version&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;commons-dbcp&lt;/groupId&gt;
                        &lt;artifactId&gt;commons-dbcp&lt;/artifactId&gt;
                        &lt;version&gt;1.3&lt;/version&gt;
                    &lt;/dependency&gt;
                &lt;/dependencies&gt;
            &lt;/plugin&gt;</pre></div>
<p>The <tt>org.apache.derby:derbyclient</tt> and <tt>commons-dbcp:commons-dbcp</tt> dependencies are required in order to define the datasource that connects to the in-memory <a class="externalLink" href="http://db.apache.org/derby/">Apache Derby</a> database.</p>
<div>
<pre>            &lt;plugin&gt;
                &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.12.4&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;integration-test&lt;/goal&gt;
                            &lt;goal&gt;verify&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;</pre></div>
<p>The <a class="externalLink" href="http://maven.apache.org/surefire/maven-failsafe-plugin/">Maven Failsafe Plugin</a> is used to execute the integration tests during the <b>integration-test</b> phase of the build life cycle.</p>
<div>
<pre>        &lt;/plugins&gt;
    &lt;/build&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
            &lt;version&gt;3.0.1&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.btmatthews.selenium.junit4&lt;/groupId&gt;
            &lt;artifactId&gt;selenium-junit4-runner&lt;/artifactId&gt;
            &lt;version&gt;1.0.4&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;4.11&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;</pre></div>
<p>The <tt>com.btmatthews.selenium.junit4:selenium-junit-runner</tt> and <tt>junit:junit</tt> dependencies are required by the integration tests.</p></div>
<div class="section">
<h3>jetty.xml<a name="jetty.xml"></a></h3>
<p>Add the following fragment of XML to the <a class="externalLink" href="http://wiki.eclipse.org/Jetty/Reference/jetty.xml">jetty.xml</a> to define a data source for the test database.</p>
<div>
<pre>&lt;New class=&quot;org.eclipse.jetty.plus.jndi.Resource&quot;&gt;
    &lt;Arg&gt;
        &lt;Ref id=&quot;Server&quot; /&gt;
    &lt;/Arg&gt;
    &lt;Arg&gt;jdbc/test&lt;/Arg&gt;
    &lt;Arg&gt;
        &lt;New class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt;
            &lt;Set name=&quot;username&quot;&gt;sa&lt;/Set&gt;
            &lt;Set name=&quot;password&quot;&gt;&lt;/Set&gt;
            &lt;Set name=&quot;url&quot;&gt;jdbc:derby://localhost/memory:test&lt;/Set&gt;
            &lt;Set name=&quot;driverClassName&quot;&gt;org.apache.derby.jdbc.ClientDriver&lt;/Set&gt;
        &lt;/New&gt;
    &lt;/Arg&gt;
&lt;/New&gt;</pre></div></div>
<div class="section">
<h3>web.xml<a name="web.xml"></a></h3>
<p>Add the following <tt>&amp;lt;resource-ref/&amp;gt;</tt> to the <b>web.xml</b> to make the datasource defined in <b>jetty.xml</b> inside the web application:</p>
<div>
<pre>&lt;resource-ref&gt;
    &lt;res-ref-name&gt;jdbc/test&lt;/res-ref-name&gt;
    &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
    &lt;res-auth&gt;Container&lt;/res-auth&gt;
&lt;/resource-ref&gt;</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2011-2014
                        <a href="http://btmatthews.com">Brian Matthews</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
